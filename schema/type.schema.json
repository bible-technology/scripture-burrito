{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://burrito.bible/schema/type.schema.json",
    "title": "Type",
    "type": "object",
    "description": "Contains properties describing the formatting of the burrito contents.",
    "definitions": {
        "canonComponentOT": {
            "properties": {
                "name": {
                    "type": "string",
                    "enum": ["ethiopianProtestant", "syriac", "tanakh", "western"]
                }
            },
            "not": {"required": ["books"]}
        },
        "canonComponentOT+": {
            "properties": {
                "name": {
                    "type": "string",
                    "enum": ["armenianApostolic", "armenianApostolic2", "armenianClassical", "catholicLxx", "catholicVulgate", "ethiopianOrthodox", "georgianOrthodox", "georgianOrthodox2", "greekOrthodox", "romanianOrthodox", "russianOrthodox", "russianProtestant"]
                }
            },
            "not": {"required": ["books"]},
            "$comment": "OT+ is OT with interleaved DC"
        },
        "canonComponentDC": {
            "properties": {
                "name": {
                    "type": "string",
                    "enum": ["armenianApostolic", "catholicAndAnglican", "catholicLxx", "catholicLxxSeparated", "catholicPlusLutheran", "catholicVulgate", "catholicVulgateSeparated", "czechKralicka", "danishLutheran", "ethiopianOrthodox", "georgianOrthodox", "georgianSynodal", "germanLutheran", "greekOrthodox", "kjv", "kjvNon", "paratext", "romanianOrthodox", "russianOrthodox", "russianSynodal", "turkishInterconfessional", "westernInterconfessional", "westernInterconfessional2"]
                }
            },
            "not": {"required": ["books"]}
        },
        "canonComponentNT": {
            "properties": {
                "name": {
                    "type": "string",
                    "enum": ["armenian", "ethiopianOrthodox", "ethiopianProtestant", "lutheran", "russian", "syriac", "western"]
                }
            },
            "not": {"required": ["books"]}
        },
        "canonComponentCustom": {
            "properties": {
                "name": {"$ref": "common.schema.json#/definitions/xToken"},
                "books": {
                    "type": "array",
                    "items": {"$ref": "common.schema.json#/definitions/bookId"},
                    "uniqueItems": true,
                    "minItems": 1
                }
            },
            "required": ["name", "books"]
        },
        "chapterVerseRange": {
            "type": "string",
            "pattern": "^(|([1-9][0-9]{0,2}(-[1-9][0-9]{0,2})?((,([1-9][0-9]{0,2}(-[1-9][0-9]{0,2})?))*))|([1-9][0-9]{0,2}:[1-9][0-9]{0,2}(-[1-9][0-9]{0,2}(:[1-9][0-9]{0,2})?)?(,(([1-9][0-9]{0,2}(-[1-9][0-9]{0,2})?)|([1-9][0-9]{0,2}:[1-9][0-9]{0,2}(-[1-9][0-9]{0,2}(:[1-9][0-9]{0,2})?)?)))*))$"
        },
        "bookOT": {
            "enum": ["GEN", "EXO", "LEV", "NUM", "DEU", "JOS", "JDG", "RUT", "1SA", "2SA", "1KI", "2KI", "1CH", "2CH", "EZR", "NEH", "EST", "JOB", "PSA", "PRO", "ECC", "SNG", "ISA", "JER", "LAM", "EZK", "DAN", "HOS", "JOL", "AMO", "OBA", "JON", "MIC", "NAM", "HAB", "ZEP", "HAG", "ZEC", "MAL"]
        },
        "bookDC": {
            "enum": ["TOB", "JDT", "ESG", "WIS", "SIR", "BAR", "LJE", "S3Y", "SUS", "BEL", "1MA", "2MA", "3MA", "4MA", "1ES", "2ES", "MAN", "PS2", "ODA", "PSS", "JSA", "JDB", "TBS", "SST", "DNT", "BLT", "EZA", "5EZ", "6EZ", "DAG", "PS3", "2BA", "LBA", "JUB", "ENO", "1MQ", "2MQ", "3MQ", "REP", "4BA", "LAO"]
        },
        "bookNT": {
            "enum": ["MAT", "MRK", "LUK", "JHN", "ACT", "ROM", "1CO", "2CO", "GAL", "EPH", "PHP", "COL", "1TH", "2TH", "1TI", "2TI", "TIT", "PHM", "HEB", "JAS", "1PE", "2PE", "1JN", "2JN", "3JN", "JUD", "REV"]
        },
        "bookOTDC": {
            "oneOf": [
                {"$ref": "#/definitions/bookOT"},
                {"$ref": "#/definitions/bookDC"}
            ]
        },
        "bookOTNT": {
            "oneOf": [
                {"$ref": "#/definitions/bookOT"},
                {"$ref": "#/definitions/bookNT"}
            ]
        }
    },
    "properties": {
        "flavorType": {
            "type": "string",
            "enum": ["scripture", "gloss", "parascriptural", "peripheral"]
        },
        "flavor": {
            "type": "string",
            "pattern": "^(x-)?[a-z][A-za-z0-9]*$"
        },
        "flavorDetails": {
            "type": "object",
            "$comment": "Schema varies per flavor; see the oneOf array below."
        },
        "bookScope": {
            "type": "object",
            "additionalProperties": {"$ref": "#/definitions/chapterVerseRange"},
            "propertyNames": {"$ref": "common.schema.json#/definitions/bookId"},
            "description": "The keys indicate which books are targeted by this work, the values indicate specific sub-ranges of the respective book or the empty string if the whole book is targeted. Note that the presence of a book in this field is not a guarantee that this book is present in the burrito itself."
        },
        "canonType": {
            "type": "array",
            "enum": [["DC"], ["NT"], ["OT", "DC", "NT"], ["OT", "NT", "DC"], ["OT", "NT"], ["OT+", "NT"], ["OT"], ["OT+"]],
            "minItems": 1,
            "maxItems": 3,
            "uniqueItems": true
        },
        "canonSpec": {
            "type": "object",
            "properties": {
                "OT": {
                    "type": "object",
                    "properties": {
                        "books": {"items": {"$ref": "#/definitions/bookOT"}}
                    },
                    "oneOf": [
                        {"$ref": "#/definitions/canonComponentOT"},
                        {"$ref": "#/definitions/canonComponentCustom"}
                    ],
                    "required": ["name"]
                },
                "OT+": {
                    "type": "object",
                    "properties": {
                        "books": {"items": {"$ref": "#/definitions/bookOTDC"}}
                    },
                    "oneOf": [
                        {"$ref": "#/definitions/canonComponentOT+"},
                        {"$ref": "#/definitions/canonComponentCustom"}
                    ],
                    "required": ["name"]
                },
                "DC": {
                    "type": "object",
                    "properties": {
                        "books": {"items": {"$ref": "#/definitions/bookDC"}}
                    },
                    "oneOf": [
                        {"$ref": "#/definitions/canonComponentDC"},
                        {"$ref": "#/definitions/canonComponentCustom"}
                    ],
                    "required": ["name"]
                },
                "NT": {
                    "type": "object",
                    "properties": {
                        "books": {"items": {"$ref": "#/definitions/bookNT"}}
                    },
                    "oneOf": [
                        {"$ref": "#/definitions/canonComponentNT"},
                        {"$ref": "#/definitions/canonComponentCustom"}
                    ],
                    "required": ["name"]
                }
            },
            "additionalProperties": false,
            "minProperties": 1,
            "allOf": [
                {"not": {"required": ["OT", "OT+"]}},
                {"not": {"required": ["DC", "OT+"]}}
            ],
            "$comment": "OT or DC may not be specified if OT+ is present."
        }
    },
    "required": ["flavor", "flavorType", "flavorDetails"],
    "additionalProperties": false,
    "oneOf": [
        {
            "properties": {
                "flavor": {"const": "scriptureText"},
                "flavorType": {"const": "scripture"},
                "flavorDetails": {"$ref": "scripture/scriptureText.schema.json"}
            },
            "required": ["canonType"]
        },
        {
            "properties": {
                "flavor": {"const": "scriptureAudio"},
                "flavorType": {"const": "scripture"},
                "flavorDetails": {"$ref": "scripture/scriptureAudio.schema.json"}
            },
            "required": ["canonType"]
        },
        {
            "properties": {
                "flavor": {"const": "scriptureSignLanguageVideo"},
                "flavorType": {"const": "scripture"},
                "flavorDetails": {"$ref": "scripture/scriptureSignLanguageVideo.schema.json"}
            },
            "required": ["canonType"]
        },
        {
            "properties": {
                "flavor": {"const": "scripturePrint"},
                "flavorType": {"const": "scripture"},
                "flavorDetails": {"$ref": "scripture/scripturePrint.schema.json"}
            },
            "required": ["canonType"]
        },
        {
            "properties": {
                "flavor": {"const": "scriptureBraille"},
                "flavorType": {"const": "scripture"},
                "flavorDetails": {"$ref": "scripture/scriptureBraille.schema.json"}
            },
            "required": ["canonType"]
        },
        {
            "properties": {
                "flavor": {"const": "glossedTextStory"},
                "flavorType": {"const": "gloss"},
                "flavorDetails": {"$ref": "gloss/glossedTextStory.schema.json"}
            }
        },
        {
            "properties": {
                "flavor": {"const": "parascriptural/wordAlignment"},
                "flavorType": {"const": "parascriptural"},
                "flavorDetails": {"$ref": "parascriptural/parascripturalWordAlignment.schema.json"}
            },
            "not": {"required": ["canonType"]}
        },
        {
            "properties": {
                "flavor": {"const": "peripheral/versification"},
                "flavorType": {"const": "peripheral"},
                "flavorDetails": {"$ref": "peripheral/peripheralVersification.schema.json"}
            },
            "not": {"required": ["canonType"]}
        }
    ],
    "allOf": [
        {
            "if": {"properties": {"canonType": {"contains": {"const": "OT"}}}},
            "then": {"properties": {"canonSpec": {"required": ["OT"]}}},
            "else": {"properties": {"canonSpec": {"not": {"required": ["OT"]}}}}
        },
        {
            "if": {"properties": {"canonType": {"contains": {"const": "OT+"}}}},
            "then": {"properties": {"canonSpec": {"required": ["OT+"]}}},
            "else": {"properties": {"canonSpec": {"not": {"required": ["OT+"]}}}}
        },
        {
            "if": {"properties": {"canonType": {"contains": {"const": "DC"}}}},
            "then": {"properties": {"canonSpec": {"required": ["DC"]}}},
            "else": {"properties": {"canonSpec": {"not": {"required": ["DC"]}}}}
        },
        {
            "if": {"properties": {"canonType": {"contains": {"const": "NT"}}}},
            "then": {"properties": {"canonSpec": {"required": ["NT"]}}},
            "else": {"properties": {"canonSpec": {"not": {"required": ["NT"]}}}}
        },
        {
            "if": {"properties": {"canonType": {"const": ["OT"]}}},
            "then": {"properties": {"bookScope": {"propertyNames": {"$ref": "#/definitions/bookOT"}}}}
        },
        {
            "if": {"properties": {"canonType": {"enum": [["OT+"], ["OT", "DC"], ["DC", "OT"]]}}},
            "then": {"properties": {"bookScope": {"propertyNames": {"$ref": "#/definitions/bookOTDC"}}}}
        },
        {
            "if": {"properties": {"canonType": {"const": ["NT"]}}},
            "then": {"properties": {"bookScope": {"propertyNames": {"$ref": "#/definitions/bookNT"}}}}
        },
        {
            "if": {"properties": {"canonType": {"enum": [["OT", "NT"], ["NT", "OT"]]}}},
            "then": {"properties": {"bookScope": {"propertyNames": {"$ref": "#/definitions/bookOTNT"}}}}
        }
    ]
}
